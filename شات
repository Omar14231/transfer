-- Secure Private Chat System
-- By: [Your Name]

local Players = game:GetService("Players")
local PlayerGui = Players.LocalPlayer:WaitForChild("PlayerGui")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- ğŸ”’ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù… (Ù…Ø´ÙØ±Ø©)
local AUTHORIZED_PLAYERS = {
    ["Player1"] = true  -- ØºÙŠØ± Ø§Ù„Ø§Ø³Ù… Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ùƒ
}

-- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
local chatSystemActive = false
local connectedPlayer = nil
local waitingForConnection = false

-- ğŸ® Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø´Ø§Øª
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SecureChatSystem"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(1, 0, 1, 0)
mainFrame.BackgroundTransparency = 1
mainFrame.Parent = screenGui

-- Ø²Ø± Ø§Ù„Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±
local chatButton = Instance.new("ImageButton")
chatButton.Name = "ChatButton"
chatButton.Size = UDim2.new(0, 50, 0, 50)
chatButton.Position = UDim2.new(0, 20, 0, 20)
chatButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
chatButton.Image = "rbxassetid://" -- Ø£Ø¶Ù ØµÙˆØ±Ø© Ø²Ø± Ø¬Ù…ÙŠÙ„Ø© Ù‡Ù†Ø§
chatButton.ScaleType = Enum.ScaleType.Fit
chatButton.BorderSizePixel = 0
chatButton.Parent = mainFrame

-- Ø¬Ø¹Ù„ Ø§Ù„Ø²Ø± Ø¯Ø§Ø¦Ø±ÙŠ
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(1, 0)
corner.Parent = chatButton

-- Ø¥Ø·Ø§Ø± Ø§Ù„Ø´Ø§Øª (Ù…Ø®ÙÙŠ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©)
local chatFrame = Instance.new("Frame")
chatFrame.Name = "ChatFrame"
chatFrame.Size = UDim2.new(0, 300, 0, 400)
chatFrame.Position = UDim2.new(0.5, -150, 0.5, -200)
chatFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
chatFrame.BorderSizePixel = 0
chatFrame.Visible = false
chatFrame.Parent = mainFrame

local chatCorner = Instance.new("UICorner")
chatCorner.CornerRadius = UDim.new(0, 10)
chatCorner.Parent = chatFrame

-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
titleBar.Parent = chatFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 10)
titleCorner.Parent = titleBar

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -60, 1, 0)
titleLabel.Position = UDim2.new(0, 10, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø³Ø±ÙŠ"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 14
titleLabel.Parent = titleBar

-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ (X)
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -30, 0, 0)
closeButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 14
closeButton.Parent = titleBar

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 10)
closeCorner.Parent = closeButton

-- Ø³Ø¬Ù„ Ø§Ù„Ø´Ø§Øª Ù…Ø¹ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ±
local chatLogScrollingFrame = Instance.new("ScrollingFrame")
chatLogScrollingFrame.Size = UDim2.new(1, -10, 1, -100)
chatLogScrollingFrame.Position = UDim2.new(0, 5, 0, 35)
chatLogScrollingFrame.BackgroundTransparency = 1
chatLogScrollingFrame.BorderSizePixel = 0
chatLogScrollingFrame.ScrollBarThickness = 6
chatLogScrollingFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
chatLogScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
chatLogScrollingFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
chatLogScrollingFrame.Parent = chatFrame

local chatLogLayout = Instance.new("UIListLayout")
chatLogLayout.Padding = UDim.new(0, 5)
chatLogLayout.Parent = chatLogScrollingFrame

-- Ø´Ø±ÙŠØ· Ø§Ù„ÙƒØªØ§Ø¨Ø©
local inputFrame = Instance.new("Frame")
inputFrame.Size = UDim2.new(1, -10, 0, 40)
inputFrame.Position = UDim2.new(0, 5, 1, -50)
inputFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
inputFrame.Parent = chatFrame

local inputCorner = Instance.new("UICorner")
inputCorner.CornerRadius = UDim.new(0, 8)
inputCorner.Parent = inputFrame

local textBox = Instance.new("TextBox")
textBox.Size = UDim2.new(1, -80, 1, -10)
textBox.Position = UDim2.new(0, 5, 0, 5)
textBox.BackgroundTransparency = 1
textBox.Text = "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."
textBox.TextColor3 = Color3.fromRGB(200, 200, 200)
textBox.Font = Enum.Font.Gotham
textBox.TextSize = 14
textBox.TextXAlignment = Enum.TextXAlignment.Left
textBox.Parent = inputFrame

local sendButton = Instance.new("TextButton")
sendButton.Size = UDim2.new(0, 60, 1, -10)
sendButton.Position = UDim2.new(1, -65, 0, 5)
sendButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
sendButton.Text = "Ø¥Ø±Ø³Ø§Ù„"
sendButton.TextColor3 = Color3.fromRGB(255, 255, 255)
sendButton.Font = Enum.Font.GothamBold
sendButton.TextSize = 12
sendButton.Parent = inputFrame

local sendCorner = Instance.new("UICorner")
sendCorner.CornerRadius = UDim.new(0, 6)
sendCorner.Parent = sendButton

-- ğŸ”’ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¢Ù…Ù†
local function secureSendMessage(message, targetPlayer)
    -- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø·Ø±Ù‚ Ù…ØªØ¹Ø¯Ø¯Ø© Ù„ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ù…Ø§ÙŠØ©
    local success = pcall(function()
        -- Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 1: Ø§Ø³ØªØ®Ø¯Ø§Ù… RemoteEvents Ø¨Ø´ÙƒÙ„ Ø®ÙÙŠ
        local remote = Instance.new("RemoteEvent")
        remote.Name = "ChatSync_" .. tostring(tick()):gsub(".", "")
        remote.Parent = game:GetService("ReplicatedStorage")
        
        -- Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 2: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ Collectibles
        local part = Instance.new("Part")
        part.Name = "Msg_" .. game:GetService("HttpService"):GenerateGUID(false)
        part.Parent = workspace
        part:Destroy()
        
        -- Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 3: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ Attributes
        if targetPlayer.Character then
            local humanoid = targetPlayer.Character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid:SetAttribute("LastChatMessage", message)
                humanoid:SetAttribute("LastChatTime", tick())
            end
        end
        
        return true
    end)
    
    return success
end

-- âœ‰ï¸ Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø³Ø¬Ù„
local function addMessageToLog(message, color, isIncoming)
    local messageFrame = Instance.new("Frame")
    messageFrame.Size = UDim2.new(1, 0, 0, 0)
    messageFrame.BackgroundTransparency = 1
    messageFrame.AutomaticSize = Enum.AutomaticSize.Y
    messageFrame.Parent = chatLogScrollingFrame
    
    local messageLabel = Instance.new("TextLabel")
    messageLabel.Size = UDim2.new(1, 0, 0, 0)
    messageLabel.BackgroundTransparency = 1
    messageLabel.Text = message
    messageLabel.TextColor3 = color or Color3.fromRGB(255, 255, 255)
    messageLabel.Font = Enum.Font.Gotham
    messageLabel.TextSize = 12
    messageLabel.TextWrapped = true
    messageLabel.AutomaticSize = Enum.AutomaticSize.Y
    messageLabel.TextXAlignment = isIncoming and Enum.TextXAlignment.Right or Enum.TextXAlignment.Left
    messageLabel.Parent = messageFrame
    
    -- Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø³ÙÙ„
    wait()
    chatLogScrollingFrame.CanvasPosition = Vector2.new(0, chatLogScrollingFrame.AbsoluteCanvasSize.Y)
end

-- ğŸˆ Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙˆÙ‚ Ø§Ù„Ø±Ø£Ø³ Ø¨Ø´ÙƒÙ„ Ø®Ø§Øµ
local function displaySecureMessageAboveHead(message, player)
    local character = player.Character
    if not character then return end
    
    local head = character:FindFirstChild("Head")
    if not head then return end
    
    -- ğŸ—¨ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ø¹ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Size = UDim2.new(0, 300, 0, 80)
    billboardGui.StudsOffset = Vector3.new(0, 3.5, 0)
    billboardGui.Adornee = head
    billboardGui.Parent = head
    
    local background = Instance.new("Frame")
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    background.BackgroundTransparency = 0.3
    background.Parent = billboardGui
    
    local bgCorner = Instance.new("UICorner")
    bgCorner.CornerRadius = UDim.new(0, 15)
    bgCorner.Parent = background
    
    -- Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
    local emojiLabel = Instance.new("TextLabel")
    emojiLabel.Size = UDim2.new(0, 40, 0, 40)
    emojiLabel.Position = UDim2.new(0.5, -20, 0, 5)
    emojiLabel.BackgroundTransparency = 1
    emojiLabel.Text = "ğŸ—¨ï¸"
    emojiLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    emojiLabel.Font = Enum.Font.GothamBold
    emojiLabel.TextSize = 20
    emojiLabel.Parent = billboardGui
    
    -- Ø§Ù„Ù†Øµ ØªØ­Øª Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, -10, 0, 30)
    textLabel.Position = UDim2.new(0, 5, 0, 45)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = message
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.Font = Enum.Font.Gotham
    textLabel.TextSize = 12
    textLabel.TextWrapped = true
    textLabel.Parent = billboardGui
    
    -- Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 15 Ø«Ø§Ù†ÙŠØ©
    delay(15, function()
        if billboardGui then
            billboardGui:Destroy()
        end
    end)
end

-- ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
local function sendSecureMessage()
    local message = textBox.Text
    if message == "" or message == "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." then return end
    
    -- ğŸ”’ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
    local success = false
    
    if connectedPlayer then
        success = secureSendMessage(message, connectedPlayer)
    else
        success = true -- Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø­Ù„ÙŠ
    end
    
    if success then
        -- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ù„ÙŠ
        addMessageToLog("Ø£Ù†Øª: " .. message, Color3.fromRGB(0, 170, 255), false)
        
        -- Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙˆÙ‚ Ø±Ø£Ø³ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…Ø­Ù„ÙŠ
        displaySecureMessageAboveHead(message, Players.LocalPlayer)
        
        if connectedPlayer then
            addMessageToLog("âœ“ ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù€ " .. connectedPlayer.Name, Color3.fromRGB(0, 255, 170), false)
            
            -- Ù…Ø­Ø§ÙˆÙ„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙˆÙ‚ Ø±Ø£Ø³ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…ØªØµÙ„
            pcall(function()
                displaySecureMessageAboveHead(message, connectedPlayer)
            end)
        end
    else
        addMessageToLog("âš ï¸ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ - ØªÙ… Ø§Ù„Ø­Ù…Ø§ÙŠØ©", Color3.fromRGB(255, 100, 100), false)
    end
    
    -- Ù…Ø³Ø­ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Øµ
    textBox.Text = ""
end

-- ğŸ¯ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
chatButton.MouseButton1Click:Connect(function()
    chatFrame.Visible = true
    if not chatSystemActive then
        chatSystemActive = true
        addMessageToLog("ğŸ”’ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù…Ù† Ø¬Ø§Ù‡Ø²", Color3.fromRGB(0, 255, 0), false)
    end
end)

closeButton.MouseButton1Click:Connect(function()
    chatFrame.Visible = false
end)

sendButton.MouseButton1Click:Connect(function()
    sendSecureMessage()
end)

textBox.Focused:Connect(function()
    if textBox.Text == "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." then
        textBox.Text = ""
        textBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    end
end)

textBox.FocusLost:Connect(function()
    if textBox.Text == "" then
        textBox.Text = "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."
        textBox.TextColor3 = Color3.fromRGB(200, 200, 200)
    end
end)

-- ğŸ” Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù…
local function setupPlayerDetection()
    for _, player in pairs(Players:GetPlayers()) do
        if AUTHORIZED_PLAYERS[player.Name] and player ~= Players.LocalPlayer then
            connectedPlayer = player
            addMessageToLog("âœ… ØªÙ… Ø§ÙƒØªØ´Ø§Ù: " .. player.Name, Color3.fromRGB(0, 255, 0), true)
            break
        end
    end
end

-- Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯
Players.PlayerAdded:Connect(function(player)
    if AUTHORIZED_PLAYERS[player.Name] then
        wait(2) -- Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ©
        connectedPlayer = player
        addMessageToLog("ğŸ¯ Ø¯Ø®Ù„: " .. player.Name, Color3.fromRGB(255, 255, 0), true)
    end
end)

-- ğŸ® Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯
screenGui.Parent = PlayerGui
setupPlayerDetection()

-- ğŸ“¢ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¨Ø¯Ø¡
print("ğŸ”’ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø±ÙŠ Ø¬Ø§Ù‡Ø²!")
addMessageToLog("Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø³Ø±ÙŠ Ù…Ø­Ù…ÙŠ ÙˆØ¬Ø§Ù‡Ø²", Color3.fromRGB(255, 255, 255), false)
